<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Study Timetable with White Noise</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    display: flex;
    height: 100vh;
  }
  #left {
    width: 30%;
    background: #111;
    color: white;
    padding: 20px;
  }
  #left h2 {
    margin-top: 0;
    letter-spacing: 2px;
  }
  .item {
    margin: 10px 0;
    opacity: 0.4;
  }
  .active {
    opacity: 1;
    font-weight: bold;
  }
  #right {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background: #f5f5f5;
  }
  #time {
    font-size: 64px;
    margin-bottom: 20px;
  }
  button {
    font-size: 18px;
    padding: 10px 20px;
    margin: 5px; /* ë²„íŠ¼ ê°„ ê°„ê²© ì¶”ê°€ */
  }
</style>
</head>

<body>

<div id="left">
  <h2>TIMETABLE</h2>
  <div id="schedule"></div>
</div>

<div id="right">
  <div id="time">--:--:--</div>
  <button onclick="ensureAudioContextAndPlayBell()">ğŸ”” ì¢…ì†Œë¦¬ í…ŒìŠ¤íŠ¸</button>
  <button onclick="toggleWhiteNoise()" id="whiteNoiseButton">ğŸ˜´ ë°±ìƒ‰ì†ŒìŒ ì¼œê¸°</button>
</div>

<script>
let audioCtx = null; // ëª¨ë“  ì˜¤ë””ì˜¤ì— ì‚¬ìš©í•  ë‹¨ì¼ AudioContext

// AudioContextê°€ ì—†ìœ¼ë©´ ìƒì„±í•˜ê³ , í™œì„±í™” ìƒíƒœì¸ì§€ í™•ì¸
function getOrCreateAudioContext() {
  if (!audioCtx) {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
  // suspend ìƒíƒœì¼ ê²½ìš° resume (ì‚¬ìš©ì ì œìŠ¤ì²˜ê°€ ìˆì–´ì•¼ í•¨)
  if (audioCtx.state === 'suspended') {
    audioCtx.resume().catch(e => console.error("AudioContext resume failed:", e));
  }
  return audioCtx;
}

/* ====== ì‚¬ìš´ë“œ ====== */
let soundEnabled = false;

// ì¢…ì†Œë¦¬ í™œì„±í™” ë° ì¬ìƒ ì‹œì‘
function ensureAudioContextAndPlayBell() {
  getOrCreateAudioContext(); // ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ê°€ ì¡´ì¬í•˜ê³  í™œì„±í™”ë˜ë„ë¡ í•¨
  playMelody();
  soundEnabled = true;
  alert("ì¢…ì†Œë¦¬ í™œì„±í™” ì™„ë£Œ");
}

/* ğŸµ ë©œë¡œë”” (0 = ì‰¼í‘œ) */
const melody = [
  // ë„ë¯¸ì†”ë¯¸ ë„ë¯¸ì†”ë¯¸
  293.66, 369.99, 440.00, 369.99,
  293.66, 369.99, 440.00, 369.99,

  // ë†’ì€ë„ë¶€í„° í•˜í–‰
  587.33, 554.37, 493.88, 440.00,
  392.00, 369.99, 329.63, 293.66,

  // ë„ (ì‰¬ê³ ) ì‹œ (ì‰¬ê³ ) ë„
  293.66, 0,
  554.37, 0,
  293.66
];

function playMelody() {
  if (!audioCtx) {
    console.warn("AudioContext not initialized for melody.");
    return;
  }
  let t = audioCtx.currentTime;

  melody.forEach(freq => {
    if (freq === 0) {
      // ì‰¼í‘œ
      t += 0.18;
      return;
    }

    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();

    osc.type = "triangle"; // ì¢… ëŠë‚Œ
    osc.frequency.value = freq;

    gain.gain.setValueAtTime(0.3, t);
    gain.gain.exponentialRampToValueAtTime(0.001, t + 0.16);

    osc.connect(gain);
    gain.connect(audioCtx.destination);

    osc.start(t);
    osc.stop(t + 0.16);

    t += 0.2; // ğŸ”¥ ë¹ ë¥¸ í…œí¬
  });
}

/* ====== ë°±ìƒ‰ì†ŒìŒ ====== */
let whiteNoiseSource = null;
let whiteNoiseGainNode;

function toggleWhiteNoise() {
  const button = document.getElementById('whiteNoiseButton');
  getOrCreateAudioContext(); // ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ê°€ ì¡´ì¬í•˜ê³  í™œì„±í™”ë˜ë„ë¡ í•¨

  if (whiteNoiseSource) { // ë°±ìƒ‰ì†ŒìŒì´ ì¬ìƒ ì¤‘ì´ë©´ ì¤‘ì§€
    whiteNoiseSource.stop();
    whiteNoiseSource.disconnect();
